<!-- 新增重新計分按鈕 -->
<section class="reset-game" style="display: none; text-align: center; margin-top: 20px;">
  <button id="reset-game">重新計分</button>
</section>

<script>
  const resetGameButton = document.getElementById('reset-game');

  // 保存到 LocalStorage
  function saveToLocalStorage() {
    const data = {
      players,
      scores,
    };
    localStorage.setItem('gameData', JSON.stringify(data));
  }

  // 從 LocalStorage 恢復資料
  function loadFromLocalStorage() {
    const data = JSON.parse(localStorage.getItem('gameData'));
    if (data) {
      players = data.players || [];
      scores = data.scores || [];

      if (players.length > 0) {
        // 恢復玩家名稱
        document.querySelector('.player-setup').style.display = 'none';
        document.querySelector('.player-names').style.display = 'none';
        document.querySelector('.score-input').style.display = 'block';
        document.querySelector('.score-table').style.display = 'block';
        document.querySelector('.reset-game').style.display = 'block';

        // 恢復玩家列表
        playerScoresDiv.innerHTML = players.map(player => `
          <label for="${player}">${player}：</label>
          <input type="number" id="${player}" name="${player}" required>
        `).join('');
        playerHeaders.innerHTML = players.map(player => `<th>${player}</th>`).join('') + '<th class="bonus-column">彩金</th>';

        // 恢復分數表
        scoreRecords.innerHTML = scores.map(round => {
          const row = document.createElement('tr');
          row.innerHTML = round.scores.map(score => `<td>${score}</td>`).join('') +
            `<td class="bonus-column">${round.bonus || ''}</td>`;
          return row.outerHTML;
        }).join('');

        // 計算總得分
        const totalScores = players.map((_, i) => scores.reduce((sum, round) => sum + round.scores[i], 0));
        totalScoresList.innerHTML = players.map((player, i) => `<li>${player}: ${totalScores[i]}</li>`).join('');
      }
    }
  }

  // 重置遊戲
  resetGameButton.addEventListener('click', function () {
    if (confirm('確定要重新計分嗎？所有紀錄將會清除！')) {
      localStorage.removeItem('gameData');
      location.reload();
    }
  });

  // 在每次更新資料後保存到 LocalStorage
  scoreForm.addEventListener('submit', function (e) {
    e.preventDefault();

    const currentScores = players.map(player => {
      const score = parseInt(document.getElementById(player).value, 10);
      return isNaN(score) ? 0 : score;
    });

    // 檢查分數加總是否為0
    const totalScore = currentScores.reduce((sum, score) => sum + score, 0);
    if (totalScore !== 0) {
      errorMessage.style.display = 'block';
      errorMessage.textContent = '此場比賽的總分數必須為0，請重新檢查分數。';
      return;
    } else {
      errorMessage.style.display = 'none';
    }

    const bonus = bonusInput.value.trim();

    // 更新分數
    scores.push({ scores: currentScores, bonus });

    // 更新表格
    const row = document.createElement('tr');
    row.innerHTML = currentScores.map(score => `<td>${score}</td>`).join('') +
      `<td class="bonus-column">${bonus}</td>`;
    scoreRecords.appendChild(row);

    // 計算總得分
    const totalScores = players.map((_, i) => scores.reduce((sum, round) => sum + round.scores[i], 0));
    totalScoresList.innerHTML = players.map((player, i) => `<li>${player}: ${totalScores[i]}</li>`).join('');

    // 清空輸入欄位
    scoreForm.reset();
    bonusInput.value = '';

    // 保存到 LocalStorage
    saveToLocalStorage();
  });

  // 在頁面加載時恢復資料
  window.addEventListener('load', loadFromLocalStorage);
</script>
