<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>大德機車行</title>
  <style>
    body {
      font-family: "標楷體", serif;
      margin: 20px;
    }
    h1, h2 {
      text-align: center;
      color: red;
      font-weight: bold;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .form-section {
      margin-bottom: 20px;
    }
    .form-section label {
      display: block;
      margin-top: 10px;
    }
    .form-section input, .form-section select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f4f4f4;
    }
    .error {
      color: red;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>大德機車行</h1>
    <h2>13隻大戰</h2>

    <!-- 玩家數量設定 -->
    <div id="player-count-section" class="form-section">
      <label for="player-count">選擇玩家數量 (3-5位)：</label>
      <select id="player-count">
        <option value="3">3人</option>
        <option value="4">4人</option>
        <option value="5">5人</option>
      </select>
      <button class="button" onclick="startGame()">開始遊戲</button>
    </div>

    <!-- 玩家名稱設定 -->
    <div id="player-names-section" class="form-section" style="display: none;">
      <h3>輸入玩家名稱</h3>
      <div id="player-name-inputs"></div>
      <button class="button" onclick="submitNames()">提交玩家名稱</button>
    </div>

    <!-- 輸入每場比賽結果 -->
    <div id="score-input-section" class="form-section" style="display: none;">
      <h3>輸入每場比賽結果</h3>
      <div id="score-inputs"></div>
      <label for="bonus">選擇彩金：</label>
      <select id="bonus">
        <option value="A">A</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="J">J</option>
        <option value="Q">Q</option>
        <option value="K">K</option>
      </select>
      <button class="button" onclick="submitScore()">新增此場輸贏</button>
      <div id="error-message" class="error" style="display: none;"></div>
    </div>

    <!-- 顯示比賽結果 -->
    <div id="score-table-section" class="form-section" style="display: none;">
      <h3>每場比賽結果</h3>
      <table id="score-table">
        <thead>
          <tr id="player-headers"></tr>
        </thead>
        <tbody id="score-records"></tbody>
        <tfoot id="total-records"></tfoot>
      </table>
      <button class="button" onclick="resetScores()">重置輸贏</button>
    </div>
  </div>

  <script>
    let players = [];
    let scores = [];

    // 開始遊戲，根據選擇的玩家數量來顯示玩家名稱輸入
    function startGame() {
      const playerCount = parseInt(document.getElementById("player-count").value);
      players = [];
      const playerNameInputs = document.getElementById("player-name-inputs");
      playerNameInputs.innerHTML = '';

      for (let i = 0; i < playerCount; i++) {
        playerNameInputs.innerHTML += `
          <label for="player${i}">玩家 ${i + 1} 名字：</label>
          <input type="text" id="player${i}" required placeholder="請輸入玩家名稱">
        `;
      }

      document.getElementById("player-count-section").style.display = "none";
      document.getElementById("player-names-section").style.display = "block";
    }

    // 提交玩家名稱
    function submitNames() {
      const playerCount = players.length;
      players = [];
      for (let i = 0; i < playerCount; i++) {
        const playerName = document.getElementById(`player${i}`).value.trim();
        if (playerName === '') {
          alert("玩家名稱不能為空！");
          return;
        }
        players.push(playerName);
      }

      document.getElementById("player-names-section").style.display = "none";
      document.getElementById("score-input-section").style.display = "block";
      renderScoreInputs();
    }

    // 渲染每場比賽的分數輸入框
    function renderScoreInputs() {
      const scoreInputs = document.getElementById("score-inputs");
      scoreInputs.innerHTML = '';
      players.forEach(player => {
        scoreInputs.innerHTML += `
          <label for="${player}">${player}：</label>
          <input type="number" id="${player}" required placeholder="輸入分數">
        `;
      });
    }

    // 提交每場比賽分數
    function submitScore() {
      const bonus = document.getElementById("bonus").value;
      const currentScores = players.map(player => {
        const score = parseInt(document.getElementById(player).value);
        return isNaN(score) ? 0 : score;
      });

      if (currentScores.reduce((a, b) => a + b, 0) !== 0) {
        document.getElementById("error-message").style.display = "block";
        document.getElementById("error-message").textContent = "每場比賽的總分數必須為 0！";
        return;
      } else {
        document.getElementById("error-message").style.display = "none";
      }

      scores.push({ scores: currentScores, bonus });
      renderScoreTable();
      renderScoreInputs();
    }

    // 渲染比賽結果表格
    function renderScoreTable() {
      const scoreRecords = document.getElementById("score-records");
      const playerHeaders = document.getElementById("player-headers");

      scoreRecords.innerHTML = '';
      playerHeaders.innerHTML = '<th>場次</th>' + players.map(player => `<th>${player}</th>`).join('') + '<th>彩金</th>';

      scores.slice().reverse().forEach((round, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${scores.length - index}</td>` + round.scores.map(score => `<td>${score}</td>`).join('');
        row.innerHTML += `<td>${round.bonus}</td>`;
        scoreRecords.appendChild(row);
      });

      const totalScores = players.map((_, i) => scores.reduce((sum, round) => sum + round.scores[i], 0));
      const totalRow = document.createElement('tr');
      totalRow.innerHTML = `<td>總計</td>` + totalScores.map(score => `<td>${score}</td>`).join('');
      totalRow.innerHTML += '<td></td>';  // 空白欄位
      document.getElementById("total-records").innerHTML = '';
      document.getElementById("total-records").appendChild(totalRow);

      document.getElementById("score-table-section").style.display = "block";
    }

    // 重置比賽結果
    function resetScores() {
      if (confirm("確定要重置所有輸贏嗎？")) {
        players = [];
        scores = [];
        document.getElementById("score-table-section").style.display = "none";
        document.getElementById("player-count-section").style.display = "block";
      }
    }
  </script>
</body>
</html>
